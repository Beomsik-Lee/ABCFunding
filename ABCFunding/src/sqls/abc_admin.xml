<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ABCAdmin">
	<select id="getJudgeList" resultType="com.hk.abcfund.model.dto.ABCJudgeDto">
		SELECT 
			LOAN.LOAN_CODE LOANCODE,JUDGE.JUDGE_SEQ JUDGESEQ,LOAN.EMAIL,MEMBER.NAME,MEMBER.BIRTH,MEMBER.GENDER,
			LOAN.PROGRESS,LOAN.EMPLOY_TYPE EMPLOYTYPE,LOAN.SCALE,LOAN.SERVE,LOAN.SALARY,LOAN.LOAN_TYPE LOANTYPE,
			LOAN.REPAY_TYPE REPAYTYPE,LOAN.INTEREST_RATE INTERESTRATE,LOAN.LOAN_MONEY LOANMONEY,LOAN.LOAN_DATE LOANDATE,LOAN.REPAY,
			LOAN.TITLE,LOAN.FNAME,LOAN.INTRO,	LOAN.EXPIRY_DATE EXPIRTYDATE,MEMBER.CREDIT_RATING CREDITRATING
		FROM
			ABC_LOAN LOAN, ABC_JUDGE JUDGE, ABC_MEMBER MEMBER
		WHERE
			LOAN.LOAN_CODE = JUDGE.LOAN_CODE
			AND JUDGE.RESULT=0
			AND MEMBER.EMAIL = LOAN.EMAIL
	</select>
	
	<select id="getJudgeDetail" parameterType="java.lang.Integer"
	resultType="com.hk.abcfund.model.dto.ABCJudgeDto">
		SELECT
			JUDGEDETAIL.LOANCODE,JUDGEDETAIL.JUDGESEQ,JUDGEDETAIL.EMAIL,JUDGEDETAIL.NAME,JUDGEDETAIL.BIRTH,JUDGEDETAIL.GENDER,
			JUDGEDETAIL.PROGRESS,JUDGEDETAIL.EMPLOYTYPE,JUDGEDETAIL.SCALE,JUDGEDETAIL.SERVE,JUDGEDETAIL.SALARY,JUDGEDETAIL.LOANTYPE,
			JUDGEDETAIL.REPAYTYPE,JUDGEDETAIL.INTERESTRATE,JUDGEDETAIL.LOANMONEY,JUDGEDETAIL.LOANDATE,JUDGEDETAIL.REPAY,
			JUDGEDETAIL.TITLE,JUDGEDETAIL.FNAME,JUDGEDETAIL.INTRO,JUDGEDETAIL.EXPIRTYDATE,JUDGEDETAIL.CREDITRATING 
		FROM
			(SELECT 
				LOAN.LOAN_CODE LOANCODE,JUDGE.JUDGE_SEQ JUDGESEQ,LOAN.EMAIL,MEMBER.NAME,MEMBER.BIRTH,MEMBER.GENDER,
				LOAN.PROGRESS,LOAN.EMPLOY_TYPE EMPLOYTYPE,LOAN.SCALE,LOAN.SERVE,LOAN.SALARY,LOAN.LOAN_TYPE LOANTYPE,
				LOAN.REPAY_TYPE REPAYTYPE,LOAN.INTEREST_RATE INTERESTRATE,LOAN.LOAN_MONEY LOANMONEY,LOAN.LOAN_DATE LOANDATE,LOAN.REPAY,
				LOAN.TITLE,LOAN.FNAME,LOAN.INTRO,	LOAN.EXPIRY_DATE EXPIRTYDATE,MEMBER.CREDIT_RATING CREDITRATING
			FROM
				ABC_LOAN LOAN, ABC_JUDGE JUDGE, ABC_MEMBER MEMBER
			WHERE
				JUDGE.LOAN_CODE = LOAN.LOAN_CODE
				AND JUDGE.RESULT=0
				AND MEMBER.EMAIL = LOAN.EMAIL) JUDGEDETAIL
		WHERE LOANCODE = #{loanCode}
	</select>
	
	<update id="addJudgeResult" parameterType="com.hk.abcfund.model.dto.ABCJudgeResultDto">
		UPDATE ABC_JUDGE
		SET COMMENTARY = #{commentary}, RESULT = #{result}
		WHERE LOAN_CODE = #{loanCode}
	</update>
	
	<select id="getJudge"
	    parameterType="java.lang.Integer"
	    resultType="com.hk.abcfund.model.dto.ABCJudgeResultDto">
	    SELECT	COMMENTARY
	    FROM	ABC_JUDGE
	    WHERE	LOAN_CODE = #{loanCode}
	</select>
	
	<delete id="deleteJudgeByLoan" parameterType="java.lang.Integer">
		DELETE 	FROM	ABC_JUDGE
				WHERE	LOAN_CODE = #{loanCode}
	</delete>
	
	<select id="getAdminLoanInfo1"
	    resultType="com.hk.abcfund.model.dto.ABCAdminLoanManageDto">
	    SELECT MAX(ROWNUM) AS STACKLOANNUM, 
        SUM(CURRENT_MONEY) AS STACKLOANMONEY
		FROM ABC_LOAN
		WHERE PROGRESS IN('펀딩완료','상환중','상환완료')
	</select>
	
	<select id="getAdminLoanInfo2"
	    resultType="com.hk.abcfund.model.dto.ABCAdminLoanManageDto">
	    SELECT SUM(A.합계) AS STACKLOANREPAYMONEY
	    FROM(
                 SELECT MAX(STACK_REPAY_RATE+STACK_REPAY_ORIGIN) AS 합계,
                           LOAN_CODE,
                           MAX(ROUND)
				 FROM ABC_LOAN_TRANSACTION
				 GROUP BY LOAN_CODE) A
	</select>
	
	<select id="getAdminLoanInfo3"
	    resultType="com.hk.abcfund.model.dto.ABCAdminLoanManageDto">
	    SELECT COUNT(PROGRESS) AS LOANENDNUM
		FROM ABC_LOAN
		WHERE PROGRESS = '상환완료'
	</select>
	
	<select id="getAdminLoanInfo4"
	    resultType="com.hk.abcfund.model.dto.ABCAdminLoanManageDto">
	    SELECT COUNT(PROGRESS) AS LOANMIDDLENUM
		FROM ABC_LOAN
		WHERE PROGRESS = '상환중'
	</select>
</mapper>